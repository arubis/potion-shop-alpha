defmodule Carafe.HardcodedSecretsTest do
  use ExUnit.Case, async: true

  describe "Configuration Security - Hardcoded Credentials Detection" do
    test "database password should not be hardcoded literal" do
      repo_config = Application.get_env(:carafe, Carafe.Repo, [])
      password = Keyword.get(repo_config, :password)
      
      # RED TEST: Assert password is NOT a hardcoded string
      # In secure code, this would be loaded from System.get_env
      # In vulnerable code, this is literally "postgres"
      assert password != "postgres",
        "VULNERABILITY: Database password is hardcoded as 'postgres'. " <>
        "Should use System.get_env/1 or runtime configuration instead."
    end

    test "database username should not be hardcoded literal" do
      repo_config = Application.get_env(:carafe, Carafe.Repo, [])
      username = Keyword.get(repo_config, :username)
      
      # RED TEST: Assert username is NOT a hardcoded string
      assert username != "postgres",
        "VULNERABILITY: Database username is hardcoded as 'postgres'. " <>
        "Should use System.get_env/1 or runtime configuration instead."
    end

    test "secret_key_base should not be hardcoded literal" do
      endpoint_config = Application.get_env(:carafe, CarafeWeb.Endpoint, [])
      secret_key_base = Keyword.get(endpoint_config, :secret_key_base)
      
      # RED TEST: Check if secret_key_base is the known hardcoded value
      hardcoded_secret = "0y8CkPHxTLgRezccWY/PgWkL8jlX8Dhf4Fpt2l40WEZ6zrzlEtSsYnSdtmBUgEOx"
      
      assert secret_key_base != hardcoded_secret,
        "VULNERABILITY: secret_key_base is hardcoded in config/dev.exs. " <>
        "Should use System.get_env/1 or mix phx.gen.secret for production."
    end
  end
end